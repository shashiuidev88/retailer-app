<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css"
        integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"
        integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN"
        crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"
        integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
        crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"
        integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
        crossorigin="anonymous"></script>
    <title>Document</title>
</head>

<body>
    <div class="container">
        <form id="transactionForm" class="row">
            <div class="col">
                <div class="form-group">
                    <label for="exampleInputEmail1">Select Customer Name</label>
                    <!-- <input type="text" class="form-control" id="name" aria-describedby="emailHelp"> -->
                    <select class="form-control" id="name">
                        <option value='' disabled selected>Select</option>
                        <option value='Customer Name 1'>Customer Name 1</option>
                        <option value='Customer Name 2'>Customer Name 2</option>
                        <option value='Customer Name 3'>Customer Name 3</option>
                        <option value='Customer Name 4'>Customer Name 4</option>
                    </select>
                </div>
            </div>
            <div class="col">
                <div class="form-group">
                    <label for="exampleInputPassword1">Transaction Date</label>
                    <input type="date" class="form-control" id="date">
                </div>
            </div>
            <div class="col">
                <div class="form-group">
                    <label for="amout">Enter Amout</label>
                    <input type="number" class="form-control" id="amount">
                </div>
            </div>
            <div class="col d-flex align-items-center justify-content-center">
                <button type="button" class="btn btn-primary" onclick="addTransaction()">Submit</button>&nbsp;
                <button type="button" class="btn btn-primary" onclick="calculateThreeMonthData()">All Points Per
                    Month</button>
            </div>
        </form>
        <table class="table text-center">
            <thead>
                <tr>
                    <th>Customer Name</th>
                    <th>Transaction Date</th>
                    <th>Amount ($)</th>
                    <th>Reward Points</th>
                </tr>
            </thead>
            <tbody id="tbody"></tbody>
        </table>

        <table class="table text-center">
            <thead>
                <tr>
                    <th rowspan="2">Customer Name</th>
                    <th colspan="12">Month Rewards</th>
                    <th rowspan="2">Total Reward Points</th>
                </tr>
                <tr>
                    <th>Jan</th>
                    <th>Feb</th>
                    <th>Mar</th>
                    <th>Apr</th>
                    <th>May</th>
                    <th>June</th>
                    <th>July</th>
                    <th>Aug</th>
                    <th>Sep</th>
                    <th>Oct</th>
                    <th>Nov</th>
                    <th>Dec</th>
                </tr>
            </thead>
            <tbody id="tbody1"></tbody>
        </table>
    </div>

    <script>
        let transactions = [];
        const tableKeys = ['name', 'dateStr', 'amount', 'points'];
        const monthsIndexs = [[0, 1, 2], [3, 4, 5], [6, 7, 8], [9, 10, 11]];
        function addTransaction() {
            const customerName = document.getElementById("name").value;
            const transactionDate = document.getElementById("date").value;
            const amount = document.getElementById("amount").value;
            const transactionObj = {
                name: customerName,
                date: new Date(transactionDate).getTime(),
                dateStr: new Date(transactionDate).toLocaleDateString(),
                amount,
                points: getPointsFromAmount(amount)
            }
            transactions.push(transactionObj);
            createTable(transactions, 'tbody', tableKeys);
        }

        function getPointsFromAmount(amount) {
            const amountInt = parseInt(amount);
            if (amountInt >= 100) {
                return ((amountInt - 100) * 2) + 50;
            } else if (amountInt >= 50) {
                return amountInt - 50;
            } else {
                return 0;
            }
        }

        function createTable(arr, tableId, columns) {
            const tbody = document.getElementById(tableId);
            let tr = ''
            for (let i = 0; i < arr.length; i++) {
                let tds = '';
                for (const x of columns) {
                    tds += `
                        <td>
                            ${arr[i][x] || '-'}
                        </td>
                    `
                }
                tr += `
                    <tr>
                        ${tds}
                    </tr>
                `
            }
            tbody.innerHTML = tr;
        }

        function calculateThreeMonthData() {
            let transactionData = {};
            for (const data of transactions) {
                const month = new Date(data.date).getMonth();
                const { name, date, dateStr, amount, points } = data;
                let allData = {};
                try {
                    allData = transactionData[name];
                } catch (e) {
                    console.log(e);
                }
                let monthRewardsOld = 0;
                transactionData[name] = {
                    name: name,
                    ...allData,
                    [month]: (() => {
                        try {
                            return points + (transactionData[name][month])
                        } catch (e) {
                            console.log('e', e);
                            return points
                        }
                    })(),
                    total: (() => {
                        try {
                            return points + transactionData[name]['total']
                        } catch (e) {
                            return points
                        }
                    })()
                }
            }
            const dataRecordsPoints = [];
            for (const name in transactionData) {
                dataRecordsPoints.push(transactionData[name]);
            }
            const monthsSequence = ['name', 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 'total'];
            createTable(dataRecordsPoints, 'tbody1', monthsSequence);
        }

    </script>
</body>

</html>
